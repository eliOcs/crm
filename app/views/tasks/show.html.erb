<%= link_to t("tasks.back"), tasks_path, class: "back-link" %>

<div class="page-header">
  <h1 class="page-header__title"><%= @task.name %></h1>
  <%= render "shared/inline_select_field",
      url: task_path(@task),
      field: :status,
      value: @task.status,
      options: Task::STATUSES.index_with { |s| t("tasks.statuses.#{s}") } %>
</div>

<div class="info-card">
  <div class="info-card__row">
    <span class="info-card__label"><%= t("tasks.fields.status") %></span>
    <span class="info-card__value">
      <%= render "shared/inline_select_field",
          url: task_path(@task),
          field: :status,
          value: @task.status,
          options: Task::STATUSES.index_with { |s| t("tasks.statuses.#{s}") } %>
    </span>
  </div>

  <div class="info-card__row">
    <span class="info-card__label"><%= t("tasks.fields.name") %></span>
    <span class="info-card__value">
      <%= render "shared/inline_edit_field",
          url: task_path(@task),
          field: :name,
          value: @task.name %>
    </span>
  </div>

  <div class="info-card__row">
    <span class="info-card__label"><%= t("tasks.fields.description") %></span>
    <span class="info-card__value">
      <%= render "shared/inline_edit_field",
          url: task_path(@task),
          field: :description,
          value: @task.description,
          placeholder: t("tasks.placeholders.no_description") %>
    </span>
  </div>

  <% if @task.due_date %>
    <div class="info-card__row">
      <span class="info-card__label"><%= t("tasks.fields.due_date") %></span>
      <span class="info-card__value <%= 'txt-danger' if @task.due_date < Date.current && @task.status != 'done' %>">
        <%= l(@task.due_date, format: :long) %>
        <% if @task.due_date < Date.current && @task.status != 'done' %>
          <span class="txt-sm"><%= t("tasks.overdue") %></span>
        <% end %>
      </span>
    </div>
  <% end %>

  <% if @task.contact %>
    <div class="info-card__row">
      <span class="info-card__label"><%= t("tasks.fields.contact") %></span>
      <span class="info-card__value">
        <%= link_to @task.contact.name || @task.contact.email, contact_path(@task.contact) %>
      </span>
    </div>
  <% end %>

  <% if @task.company %>
    <div class="info-card__row">
      <span class="info-card__label"><%= t("tasks.fields.company") %></span>
      <span class="info-card__value">
        <%= link_to @task.company.display_name, company_path(@task.company) %>
      </span>
    </div>
  <% end %>

  <div class="info-card__row">
    <span class="info-card__label"><%= t("tasks.fields.created") %></span>
    <span class="info-card__value txt-muted"><%= l(@task.created_at, format: :long) %></span>
  </div>

  <div class="info-card__row">
    <span class="info-card__label"><%= t("tasks.fields.last_updated") %></span>
    <span class="info-card__value txt-muted"><%= l(@task.updated_at, format: :long) %></span>
  </div>
</div>

<%= render "shared/audit_log_section", record: @task %>
