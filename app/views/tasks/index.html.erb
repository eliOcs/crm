<div class="page-header">
  <h1 class="page-header__title"><%= t("tasks.title") %></h1>
  <span class="page-header__subtitle txt-muted"><%= t("tasks.total", count: @tasks.count) %></span>
</div>

<% if @tasks.any? %>
  <div class="table-responsive">
    <table class="table table--hover">
      <thead>
        <tr>
          <th><%= t("tasks.fields.status") %></th>
          <th><%= t("tasks.fields.name") %></th>
          <th><%= t("tasks.fields.due_date") %></th>
          <th><%= t("tasks.fields.contact") %></th>
          <th><%= t("tasks.fields.updated") %></th>
        </tr>
      </thead>
      <tbody>
        <% @tasks.each do |task| %>
          <tr>
            <td>
              <%= render "shared/inline_select_field",
                  url: task_path(task),
                  field: :status,
                  value: task.status,
                  options: Task::STATUSES.index_with { |s| t("tasks.statuses.#{s}") } %>
            </td>
            <td><%= link_to task.name, task %></td>
            <td class="txt-sm <%= 'txt-danger' if task.due_date && task.due_date < Date.current && task.status != 'done' %>">
              <%= l(task.due_date, format: :short) if task.due_date %>
            </td>
            <td class="txt-sm txt-muted"><%= task.contact&.name || task.contact&.email %></td>
            <td class="txt-sm txt-muted"><%= time_ago_in_words(task.updated_at) %> <%= t("tasks.ago") %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <div class="empty-state">
    <p class="empty-state__message"><%= t("tasks.empty") %></p>
  </div>
<% end %>
