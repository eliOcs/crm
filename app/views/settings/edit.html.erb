<div class="page-header">
  <h1 class="page-header__title"><%= t("settings.title") %></h1>
</div>

<div class="info-card">
  <%= form_with model: Current.user, url: settings_path, method: :patch, class: "form" do |form| %>
    <div class="field">
      <%= form.label :locale, t("settings.language") %>
      <p class="field__hint"><%= t("settings.language_description") %></p>
      <%= form.select :locale,
            options_for_select([
              [t("settings.languages.en"), "en"],
              [t("settings.languages.es"), "es"]
            ], Current.user.locale),
            {},
            class: "select" %>
    </div>

    <div class="form__actions">
      <%= form.submit t("common.save"), class: "btn btn--primary" %>
    </div>
  <% end %>
</div>

<div class="info-card">
  <h2><%= t("settings.integrations") %></h2>

  <div class="field">
    <label><%= t("settings.microsoft.title") %></label>
    <p class="field__hint"><%= t("settings.microsoft.description") %></p>

    <% if Current.user.microsoft_connected? %>
      <div class="integration-status">
        <span class="integration-status__email">
          <%= t("settings.microsoft.connected_as", email: Current.user.microsoft_credential.email) %>
        </span>
        <%= button_to t("settings.microsoft.disconnect"),
              disconnect_auth_microsoft_path,
              method: :delete,
              class: "btn btn--secondary",
              data: { turbo_confirm: t("settings.microsoft.disconnect_confirm") } %>
      </div>
    <% else %>
      <%= link_to t("settings.microsoft.connect"),
            connect_auth_microsoft_path,
            class: "btn btn--primary",
            data: { turbo: false } %>
    <% end %>
  </div>
</div>

<% if Current.user.microsoft_connected? %>
  <div class="info-card">
    <h2><%= t("microsoft_import.title") %></h2>
    <p class="field__hint mar-b-md"><%= t("microsoft_import.description") %></p>

    <%= turbo_stream_from Current.user, :microsoft_import %>
    <%= render "microsoft_import_status" %>
  </div>
<% end %>
