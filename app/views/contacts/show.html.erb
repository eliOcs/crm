<%= link_to "Back to contacts", contacts_path, class: "back-link" %>

<div class="page-header">
  <h1 class="page-header__title"><%= @contact.name.presence || @contact.email %></h1>
</div>

<div class="info-card margin-block-end-double">
  <dl>
    <dt>Email</dt>
    <dd><%= @contact.email %></dd>

    <dt>Name</dt>
    <dd><%= render "shared/inline_edit_field", url: contact_path(@contact), field: "name", value: @contact.name %></dd>

    <dt>Job Role</dt>
    <dd><%= render "shared/inline_edit_field", url: contact_path(@contact), field: "job_role", value: @contact.job_role %></dd>

    <dt>Department</dt>
    <dd><%= render "shared/inline_edit_field", url: contact_path(@contact), field: "department", value: @contact.department %></dd>

    <dt>Phone Numbers</dt>
    <dd><%= render "shared/inline_edit_field", url: contact_path(@contact), field: "phone_numbers", value: @contact.phone_numbers&.join(", "), placeholder: "Not provided (comma-separated)" %></dd>

    <dt>Companies</dt>
    <dd>
      <% if @contact.companies.any? %>
        <ul>
          <% @contact.companies.each do |company| %>
            <li><%= link_to company.display_name, company %></li>
          <% end %>
        </ul>
      <% else %>
        <span class="txt-subtle">Not linked to any company</span>
      <% end %>
    </dd>
  </dl>
</div>

<section class="section">
  <div class="section__header">
    <h2 class="section__title">Audit Log</h2>
  </div>

  <div class="table-responsive">
    <table class="table table--compact">
      <thead>
        <tr>
          <th>Date</th>
          <th>Action</th>
          <th>Message</th>
          <th>By</th>
          <th>Source</th>
          <th>Changes</th>
        </tr>
      </thead>
      <tbody id="audit_log_entries">
        <% @contact.audit_logs.order(created_at: :desc).each do |log| %>
          <%= render partial: "audit_logs/audit_log", locals: { audit_log: log } %>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if @contact.audit_logs.empty? %>
    <p class="txt-subtle">No audit history yet.</p>
  <% end %>
</section>
