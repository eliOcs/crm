<tr id="<%= dom_id(audit_log) %>">
  <td class="txt-nowrap"><%= audit_log.created_at.strftime("%Y-%m-%d %H:%M") %></td>
  <td><%= audit_log.action %></td>
  <td><%= audit_log.message %></td>
  <td>
    <% if audit_log.metadata["source"] == "ui" %>
      <span class="txt-sm"><%= t("audit_log.by_user") %></span>
    <% else %>
      <span class="txt-sm txt-subtle"><%= t("audit_log.by_system") %></span>
    <% end %>
  </td>
  <td>
    <% if audit_log.metadata["source_email"].present? %>
      <% full_path = EmlReader::EMAILS_DIR.join(audit_log.metadata["source_email"]).to_s %>
      <%= link_to audit_log.metadata["source_email"], email_path(EmlReader.encode_path(full_path)), class: "txt-sm" %>
    <% end %>
  </td>
  <td>
    <% if audit_log.field_changes.any? %>
      <ul class="txt-sm">
        <% audit_log.field_changes.each do |field, change| %>
          <li><strong><%= field %></strong>: <%= change["from"].presence || t("audit_log.empty_value") %> &rarr; <%= change["to"] %></li>
        <% end %>
      </ul>
    <% end %>
  </td>
</tr>
